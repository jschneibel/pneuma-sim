<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file The main entry point of the application. Initializes the DOM, including canvas and listeners.
 * @author Jonathan Schneibel
 * @module
 */

import { ELEMENTS } from "./constants.js";

import { createDiagram } from "./diagram/diagram.js";
import { initializeCanvas } from "./canvas/canvas.js";

import { createSimulation } from "./simulation/simulation.js";
import {
  addCommonEventHandlers,
  addEditingEventHandlers,
  addSimulationEventHandlers,
} from "./input/index.js";

export default (async function main() {
  const diagram = await createDiagram();
  const { canvas, ctx } = initializeCanvas("canvas", diagram);

  // Adding handlers returns a function to remove handlers again.
  let removeCommonEventHandlers = addCommonEventHandlers(canvas, ctx, diagram);
  let removeEditingEventHandlers = addEditingEventHandlers(
    canvas,
    ctx,
    diagram
  );
  let removeSimulationEventHandlers; // Assigned on simulation start.

  const elementBoxDiv = document.getElementById("element-box");
  for (const element of ELEMENTS.filter((element) => element.editorButton)) {
    const elementButton = document.createElement("a");
    elementButton.setAttribute("id", element.type + "-button");
    elementButton.classList.add("element-link");
    elementButton.textContent = element.label;
    elementButton.onclick = createElementButtonOnClickHandler(element.type);
    elementBoxDiv.appendChild(elementButton);
  }

  /**
   * Creates an onClickHandler function that creates an element object
   * based on the given element type.
   *
   * @param {string} elementType
   * @returns {Function} onClickHandler to create an element object.
   */
  function createElementButtonOnClickHandler(elementType) {
    return function () {
      diagram.unselectAll();
      const element = diagram.add[elementType]();
      element.select?.();
      ctx.draw();
    };
  }

  const simulation = createSimulation(diagram, ctx);

  const simulationStartButton = document.getElementById("simulation-start");
  const simulationStepButton = document.getElementById("simulation-step");
  const simulationPauseButton = document.getElementById("simulation-pause");
  const simulationStopButton = document.getElementById("simulation-stop");

  // TODO: Make element buttons inactive (i.e. cannot insert new elements)
  // during Simulation.

  // TODO: Grey out all inactive buttons during editing and simulation.

  simulationStartButton.onclick = function (event) {
    if (!simulation.isStarted()) {
      removeEditingEventHandlers();
      removeSimulationEventHandlers = addSimulationEventHandlers(
        canvas,
        ctx,
        diagram,
        simulation
      );
    }

    simulationStartButton.classList.add("highlighted");
    simulationPauseButton.classList.remove("highlighted");

    simulation.start();
  };

  simulationStepButton.onclick = function (event) {
    if (!simulation.isStarted()) {
      removeEditingEventHandlers();
      removeSimulationEventHandlers = addSimulationEventHandlers(
        canvas,
        ctx,
        diagram,
        simulation
      );
    }

    simulationStartButton.classList.remove("highlighted");
    simulationPauseButton.classList.add("highlighted");

    simulation.step();
  };

  simulationPauseButton.onclick = function (event) {
    if (simulation.isRunning()) {
      simulationStartButton.classList.remove("highlighted");
      simulationPauseButton.classList.add("highlighted");

      simulation.pause();
    }
  };

  simulationStopButton.onclick = function (event) {
    if (simulation.isStarted()) {
      removeSimulationEventHandlers();
      removeEditingEventHandlers = addEditingEventHandlers(
        canvas,
        ctx,
        diagram
      );

      simulationStartButton.classList.remove("highlighted");
      simulationPauseButton.classList.remove("highlighted");

      simulation.stop();
    }
  };
})();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="constants.module_js.html">constants.js</a></li><li><a href="diagram_elements_mixins_mixinActive.module_js.html">diagram/elements/mixins/mixinActive.js</a></li><li><a href="diagram_elements_mixins_mixinHighlighting.module_js.html">diagram/elements/mixins/mixinHighlighting.js</a></li><li><a href="diagram_elements_mixins_mixinName.module_js.html">diagram/elements/mixins/mixinName.js</a></li><li><a href="diagram_elements_mixins_mixinPosition.module_js.html">diagram/elements/mixins/mixinPosition.js</a></li><li><a href="diagram_elements_mixins_mixinRemoval.module_js.html">diagram/elements/mixins/mixinRemoval.js</a></li><li><a href="diagram_elements_utils_geometry.module_js.html">diagram/elements/utils/geometry.js</a></li><li><a href="input_utils_snapping.module_js.html">input/utils/snapping.js</a></li><li><a href="main.module_js.html">main.js</a></li><li><a href="simulation_simulation.module_js.html">simulation/simulation.js</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Aug 31 2021 16:55:49 GMT+0200 (Mitteleurop√§ische Sommerzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
